var Lang=(function(){var a=function(){this._fireEvents=true;this._dynamic={}};a.prototype.init=function(f){var c=this,b,e,g,d;f=f||{};f.cookie=f.cookie||{};e=f.defaultLang;g=f.currentLang;d=f.allowCookieOverride;this.cookieName=f.cookie.name||"langCookie";this.cookieExpiry=f.cookie.expiry||365;this.cookiePath=f.cookie.path||"/";this._mutationCopies={append:$.fn.append,appendTo:$.fn.appendTo,prepend:$.fn.prepend,before:$.fn.before,after:$.fn.after,html:$.fn.html};$.fn.append=function(){return c._mutation(this,"append",arguments)};$.fn.appendTo=function(){return c._mutation(this,"appendTo",arguments)};$.fn.prepend=function(){return c._mutation(this,"prepend",arguments)};$.fn.before=function(){return c._mutation(this,"before",arguments)};$.fn.after=function(){return c._mutation(this,"after",arguments)};$.fn.html=function(){return c._mutation(this,"html",arguments)};this.defaultLang=e||"en";this.currentLang=e||"en";if((d||!g)&&typeof Cookies!=="undefined"){b=Cookies.get(this.cookieName);if(b){g=b}}$(function(){c._start();if(g&&g!==c.defaultLang){c.change(g)}})};a.prototype.pack={};a.prototype.attrList=["title","alt","placeholder","href"];a.prototype.dynamic=function(c,b){if(c!==undefined&&b!==undefined){this._dynamic[c]=b}};a.prototype.loadPack=function(d,c){var b=this;if(d&&b._dynamic[d]){$.ajax({dataType:"json",url:b._dynamic[d],success:function(h){b.pack[d]=h;if(b.pack[d].regex){var g=b.pack[d].regex,f,e;for(e=0;e<g.length;e++){f=g[e];if(f.length===2){f[0]=new RegExp(f[0])}else{if(f.length===3){f[0]=new RegExp(f[0],f[1]);f.splice(1,1)}}}}if(c){c(false,d,b._dynamic[d])}},error:function(){if(c){c(true,d,b._dynamic[d])}throw ("Error loading language pack"+b._dynamic[d])}})}else{throw ("Cannot load language pack, no file path specified!")}};a.prototype._start=function(c){var b=c!==undefined?$(c).find("[lang]"):$(":not(html)[lang]"),e=b.length,d;while(e--){d=$(b[e]);this._processElement(d)}};a.prototype._processElement=function(b){if(b.attr("lang")===this.defaultLang){this._storeAttribs(b);this._storeContent(b)}};a.prototype._storeAttribs=function(e){var c,b,d;for(c=0;c<this.attrList.length;c++){b=this.attrList[c];if(e.attr(b)){d=e.data("lang-attr")||{};d[b]=e.attr(b);e.data("lang-attr",d)}}};a.prototype._storeContent=function(c){if(c.is("input")){switch(c.attr("type")){case"button":case"submit":case"hidden":case"reset":c.data("lang-val",c.val());break}}else{if(c.is("img")){c.data("lang-src",c.attr("src"))}else{var b=this._getTextNodes(c);if(b){c.data("lang-text",b)}}}};a.prototype._getTextNodes=function(e){var b=e.contents(),c=[],f={},h,d=this,g=Array.prototype.map;$.each(b,function(i,j){if(j.nodeType!==3){return}f={node:j,langDefaultText:j.data};c.push(f)});if(b.length==1){c[0].langToken=e.data("langToken")}return c};a.prototype._setTextNodes=function(d,b,c){var g,f,k,i,j=c!==this.defaultLang;for(g=0;g<b.length;g++){f=b[g];if(j){k=f.langToken||$.trim(f.langDefaultText);if(k){i=this.translate(k,c);if(i){try{f.node.data=f.node.data.split($.trim(f.node.data)).join(i)}catch(h){}}else{if(console&&console.log){console.log('Translation for "'+k+'" not found!')}}}}else{try{f.node.data=f.langDefaultText}catch(h){}}}};a.prototype._translateAttribs=function(d,f){var b,c=d.data("lang-attr")||{},e;for(b in c){if(c.hasOwnProperty(b)){if(d.attr(b)){if(f!==this.defaultLang){e=this.translate(c[b],f);if(e){d.attr(b,e)}}else{d.attr(b,c[b])}}}}};a.prototype._translateContent=function(d,f){var b=f!==this.defaultLang,e,c;if(d.is("input")){switch(d.attr("type")){case"button":case"submit":case"hidden":case"reset":if(b){e=this.translate(d.data("lang-val"),f);if(e){d.val(e)}}else{d.val(d.data("lang-val"))}break}}else{if(d.is("img")){if(b){e=this.translate(d.data("lang-src"),f);if(e){d.attr("src",e)}}else{d.attr("src",d.data("lang-src"))}}else{c=d.data("lang-text");if(c){this._setTextNodes(d,c,f)}}}};a.prototype.change=function(b,d,h){var i=this;if(b===this.defaultLang||this.pack[b]||this._dynamic[b]){if(b!==this.defaultLang){if(!this.pack[b]&&this._dynamic[b]){this.loadPack(b,function(l,k,m){if(!l){i.change.call(i,b,d,h)}else{if(h){h("Language pack could not load from: "+m,b,d)}}});return}else{if(!this.pack[b]&&!this._dynamic[b]){if(h){h("Language pack not defined for: "+b,b,d)}throw ("Could not change language to "+b+" because no language pack for this language exists!")}}}var f=false,e=this.currentLang;if(this.currentLang!=b){this.beforeUpdate(e,b);f=true}this.currentLang=b;var g=d!==undefined?$(d).find("[lang]"):$(":not(html)[lang]"),j=g.length,c;while(j--){c=$(g[j]);if(c.attr("lang")!==b){this._translateElement(c,b)}}if(f){this.afterUpdate(e,b)}if(typeof Cookies!=="undefined"){Cookies.set(i.cookieName,b,{expires:i.cookieExpiry,path:i.cookiePath})}if(h){h(false,b,d)}}else{if(h){h("No language pack defined for: "+b,b,d)}throw ('Attempt to change language to "'+b+'" but no language pack for that language is loaded!')}};a.prototype._translateElement=function(b,c){this._translateAttribs(b,c);if(b.attr("data-lang-content")!="false"){this._translateContent(b,c)}b.attr("lang",c)};a.prototype.translate=function(d,c){c=c||this.currentLang;if(this.pack[c]){var b="";if(c!=this.defaultLang){b=this.pack[c].token[d];if(!b){b=this._regexMatch(d,c)}if(!b){if(console&&console.log){console.log('Translation for "'+d+'" not found in language pack: '+c)}}return b||d}else{return d}}else{return d}};a.prototype._regexMatch=function(i,h){var c,g,b,e,d,f;c=this.pack[h].regex;if(c){g=c.length;for(b=0;b<g;b++){e=c[b];d=e[0];f=d.exec(i);if(f&&f[0]){return i.split(f[0]).join(e[1])}}}return""};a.prototype.beforeUpdate=function(c,b){if(this._fireEvents){$(this).triggerHandler("beforeUpdate",[c,b,this.pack[c],this.pack[b]])}};a.prototype.afterUpdate=function(c,b){if(this._fireEvents){$(this).triggerHandler("afterUpdate",[c,b,this.pack[c],this.pack[b]])}};a.prototype.refresh=function(){this._fireEvents=false;this.change(this.currentLang);this._fireEvents=true};a.prototype._mutation=function(d,g,c){var f=this._mutationCopies[g].apply(d,c),b=this.currentLang,e=$(d);if(e.attr("lang")){this._fireEvents=false;this._translateElement(e,this.defaultLang);this.change(this.defaultLang,e);this.currentLang=b;this._processElement(e);this._translateElement(e,this.currentLang)}this._start(e);this.change(this.currentLang,e);this._fireEvents=true;return f};return a})();
